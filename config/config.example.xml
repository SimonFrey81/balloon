<config version="1.0" xmlns:m="https://github.com/gyselroth/micro">
<production>
    <mongodb m:name="MongoDB\Client">
        <options>
            <db>balloon</db>
            <uri>mongodb://localhost:27017</uri>
        </options>
    </mongodb>

    <server m:name="Balloon\Server">
        <options>
            <config>
                <temp>/tmp/balloon</temp>
                <max_version>8</max_version>
                <max_size>1073741824</max_size>
            </config>
        </options>
    </server>

    <apps m:name="Balloon\App">
        <adapter>
            <Api enabled="1" m:name="Balloon\App\Api\App"/>
            <Webdav enabled="1" m:name="Balloon\App\Webdav\App"/>
            <Sharelink enabled="1" m:name="Balloon\App\Sharelink\App"/>
            <Convert enabled="1" m:name="Balloon\App\Convert\App"/>
            <preview enabled="1" m:name="Balloon\App\Preview\App"/>

            <office enabled="1" m:name="Balloon\App\Office\App">
                <options>
                    <config>
                        <loleaflet>http://localhost:9980/loleaflet/dist/loleaflet.html</loleaflet>
                        <token_ttl>1800</token_ttl>
                    </config>
                </options>
            </office>

            <elasticsearch enabled="1" m:name="Balloon\App\Elasticsearch\App">
                <options>
                    <config>
                        <hosts>
                            <server>http://localhost:9200</server>
                        </hosts>
                        <index>balloon</index>
                    </config>
                </options>
            </elasticsearch>

            <ClamAv enabled="0" m:name="Balloon\App\ClamAv\App">
                <options>
                    <config>
                        <socket>unix:///var/run/clamav/clamd.ctl</socket>
                        <max_stream_size>26214400</max_stream_size>
                        <aggressiveness>3</aggressiveness>
                        <timeout>30</timeout>
                    </config>
                </options>
            </ClamAv>

            <notify enabled="1" m:name="Balloon\App\Notification\App">
                <adapter>
                    <mail enabled="1" m:name="Balloon\App\Notification\Adapter\Mail">
                        <options>
                            <config>
                                <sender_address>no-reply@localhost</sender_address>
                                <sender_name>balloon</sender_name>
                            </config>
                        </options>
                    </mail>
                    <db enabled="1" m:name="Balloon\App\Notification\Adapter\Db"/>
                </adapter>
                <options>
                    <config>
                        <notifications>
                            <new_share enabled="1">
                                <config>
                                    <body>{shareowner} added a new share {name} to your cloud.</body>
                                    <subject>Balloon: A new share has been added to your cloud</subject>
                                </config>
                            </new_share>
                        </notifications>
                    </config>
                </options>
            </notify>

            <!--
            <destroyer enabled="0" m:name="Balloon\App\Destroyer">
                 <config/>
            </destroyer>

            <clean_temp enabled="0" m:name="Balloon\App\CleanTemp">
                <config>
                    <dir>/tmp/balloon</dir>
                    <force_check_owner>33</force_check_owner>
                    <max_age>3600</max_age>
                </config>
            </clean_temp>

            <clean_trash enabled="0" m:name="Balloon\App\CleanTrash">
                <config>
                    <max_age>2592000</max_age>
                </config>
            </clean_trash>
            <auto_share enabled="1" m:name="Balloon\App\LdapAutoShare">
                <config>
                    <ldap>
                        <host>ldap.example.org</host>
                        <port>389</port>
                        <basedn>ou=shares,dc=example,dc=org</basedn>
                        <username>uid=bind,dc=example,dc=org</username>
                        <password>1234</password>
                        <tls>1</tls>
                        <options>
                            <option attr="LDAP_OPT_PROTOCOL_VERSION" value="3"/>
                        </options>
                    </ldap>
                    <auto_delete>1</auto_delete>
                    <shares>
                        <share1>
                            <share_owner>SYSTEM</share_owner>
                            <subfolder_attr>o</subfolder_attr>
                            <acl>
                                <rule1>
                                    <type>group</type>
                                    <priv>r</priv>
                                    <role_attr>dn</role_attr>
                                </rule1>
                                <rule2>
                                    <type>user</type>
                                    <priv>rw</priv>
                                    <role_attr>member</role_attr>
                                    <user_attr>ldapdn</user_attr>
                                </rule2>
                            </acl>
                            <filter>(&amp;(objectClass=groupOfNames)(cn=*))</filter>
                            <share_name>cn</share_name>
                        </share1>
                    </shares>
                </config>
            </auto_share>-->
        </adapter>
    </apps>

    <storage m:name="Balloon\Filesystem\Storage">
        <adapter>
            <gridfs enabled="1" use="Balloon\Filesystem\Storage\Adapter\Gridfs"/>
        </adapter>
    </storage>

    <hooks m:name="Balloon\Hook">
        <adapter>
            <delta enabled="1" m:name="Balloon\Hook\Delta"/>

            <autoCreateUser enabled="1" m:name="Balloon\Hook\AutoCreateUser">
                <options>
                    <config>
                        <attributes>
                            <soft_quota type="int" value="10000000"/>
                            <hard_quota type="int" value="10000000"/>
                        </attributes>
                    </config>
                </options>
            </autoCreateUser>
        </adapter>
    </hooks>

    <convert m:name="Balloon\Convert">
        <adapter>
            <imagick enabled="1" m:name="Balloon\Convert\Adapter\Imagick">
                <options>
                    <config>
                        <max_size>300</max_size>
                    </config>
                </options>
            </imagick>

            <office enabled="1" m:name="Balloon\Convert\Adapte\Office">
                <options>
                    <config>
                        <max_size>300</max_size>
                        <timeout>10</timeout>
                        <tmp>/tmp/balloon</tmp>
                        <soffice>/usr/bin/soffice</soffice>
                    </config>
                </options>
            </office>
        </adapter>
    </convert>

    <log m:name="Psr\Log\LoggerInterface" use="Micro\Log">
        <adapter>
            <file enabled="1" use="Micro\Log\Adapter\File">
                <options>
                    <config>
                        <file>APPLICATION_PATH/log/out.log</file>
                        <date_format>Y-d-m H:i:s</date_format>
                        <format>{date} [{context.category},{level}]: {message} {context.params} {context.exception}</format>
                        <level>10</level>
                    </config>
                </options>
            </file>

            <stdout enabled="0" use="Micro\Log\Adapter\Stdout">
                <options>
                    <config>
                        <date_format>Y-d-m H:i:s</date_format>
                        <format>{date} [{context.category},{level}]: {message} {context.params} {context.exception}</format>
                        <level>3</level>
                    </config>
                </options>
            </stdout>

            <syslog enabled="0" use="Micro\Log\Adapter\Syslog">
                <options>
                    <config>
                        <date_format>Y-d-m H:i:s</date_format>
                        <format>{date} [{context.category},{level}]: {message} {context.params} {context.exception}</format>
                        <level>3</level>
                        <ident>balloon</ident>
                    </config>
                </options>
            </syslog>
        </adapter>
    </log>

    <auth m:name="Micro\Auth">
        <adapter>
            <basic_db enabled="1" use="Balloon\Auth\Adapter\Basic\Db"/>

            <oidc enabled="0" use="Micro\Auth\Adapter\Oidc">
                <options>
                    <config>
                        <provider_url>https://openidconnect.example.net</provider_url>
                    </config>
                </options>
            </oidc>

            <preauth enabled="0" use="Micro\Auth\Adapter\Preauth">
                <options>
                    <config>
                        <key>random_pre_auth_key</key>
                        <source>
                            <lan>192.168.1.0/24</lan>
                            <localhost>127.0.10.1</localhost>
                        </source>
                        <account_filter>(uid=%s)</account_filter>
                        <attr_sync_cache>3600</attr_sync_cache>
                    </config>
                </options>
            </preauth>

            <basic_ldap enabled="1" use="Micro\Auth\Adapter\Basic\Ldap">
                <service>
                    <ldap m:name="Micro\Ldap">
                        <options>
                            <config>
                                <uri>ldap://ldap.example.org:389</uri>
                                <basedn>dc=example,dc=org</basedn>
                                <username>uid=bind,dc=example,dc=org</username>
                                <password>1234</password>
                                <tls>1</tls>
                                <options>
                                    <option attr="LDAP_OPT_PROTOCOL_VERSION" value="3"/>
                                </options>
                            </config>
                        </options>
                    </ldap>
                </service>

                <options>
                    <config>
                        <account_filter>(uid=%s)</account_filter>
                        <attr_sync_cache>3600</attr_sync_cache>
                        <map>
                            <namespace type="string" attr="o"/>
                            <avatar type="binary" attr="jpegPhoto"/>
                            <hard_quota type="int" attr="customHardQuotaAttribute"/>
                            <soft_quota type="int" attr="customSoftQuotaAttribute"/>
                            <groups type="array" attr="memberof"/>
                            <mail type="string" attr="mail"/>
                            <ldapdn type="string" attr="dn"/>
                        </map>
                    </config>
                </options>
            </basic_ldap>
        </adapter>
    </auth>
</production>
</config>
